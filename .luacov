-- Configuration file for LuaCov

-- This variable is set externally
local source = os.getenv("SOURCE_DIRECTORY") or os.getenv("PWD") or (...):gsub('%.[^%.]+$', '')
print("source = " .. tostring(source))

local function escape_pattern(str)
    local str_sub = string.gsub(str, "%W", "%%%1")
    print(str_sub)
    return str_sub
end

--- I want to have fixed pathes on coveralls.io, without changing the path on coveralls.io manually..
---@param str string
local function fix_paths(str)
    local str_replace = string.gsub(str, "home/runner/work/NoitaMP/NoitaMP/", "")
    str_replace = string.gsub(str, "mods/", "")
    return str_replace
end

return {
    --statsfile = build .. "/luacov.stats.out",
    --reportfile = build .. "/luacov.report.out",
    --include = {
    --    escape_pattern(source) .. "/.+",
    --    -- Relative paths (to source/build dir).
    --    "^[^/].+"
    --},
    -- configuration for luacov-coveralls reporter
    coveralls = {
        pathcorrect = {
            {
                --escape_pattern(source .. "/"),
                --""
                fix_paths(source .. "")
            }
        }
    }
}
